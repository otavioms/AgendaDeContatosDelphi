unit TelaCadastro;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.Mask, Vcl.StdCtrls, Vcl.ExtCtrls, Datasnap.DBClient;

type
  TfrmTelaCadastro = class(TForm)
    pnlContato: TPanel;
    pnlBotoes: TPanel;
    btnCancelar: TButton;
    btnOK: TButton;
    lblNome: TLabel;
    lblTelefone: TLabel;
    lblEmail: TLabel;
    edtEmail: TEdit;
    edtNome: TEdit;
    edtTelefone: TMaskEdit;
  private
    { Private declarations }
  public
    { Public declarations }
    class procedure Adicionar(pDataSet: TClientDataSet; pOwner: TComponent);
    class procedure Editar(pDataSet: TClientDataSet; pOwner: TComponent);
    class procedure Remover(pDataSet: TClientDataSet; pOwner: TComponent);
  end;

var
  frmTelaCadastro: TfrmTelaCadastro;

implementation

class procedure TfrmTelaCadastro.Adicionar(pDataSet: TClientDataSet; pOwner: TComponent);
begin
  var lFrmTelaCadastro := TfrmTelaCadastro.Create(pOwner);
  try
    if lFrmTelaCadastro.ShowModal = mrOk then
    begin
      if Trim(lFrmTelaCadastro.edtNome.Text) = '' then
        raise Exception.Create('O campo nome é obrigatório.');


      pDataSet.Append;
      pDataSet.FieldByName('Nome').AsString := lFrmTelaCadastro.edtNome.Text;
      pDataSet.FieldByName('Telefone').AsString := lFrmTelaCadastro.edtTelefone.Text;
      pDataSet.FieldByName('E-mail').AsString := lFrmTelaCadastro.edtEmail.Text;
      pDataSet.Post;
    end;
  finally
    lFrmTelaCadastro.Free;
  end;
end;

class procedure TfrmTelaCadastro.Editar(pDataSet: TClientDataSet; pOwner: TComponent);
begin
  var lFrmTelaCadastro := TfrmTelaCadastro.Create(pOwner);
  try
    lFrmTelaCadastro.edtNome.Text := pDataSet.FieldByName('Nome').AsString;
    lFrmTelaCadastro.edtTelefone.Text := pDataSet.FieldByName('Telefone').AsString;
    lFrmTelaCadastro.edtEmail.Text := pDataSet.FieldByName('E-mail').AsString;

    if lFrmTelaCadastro.ShowModal = mrOk then
    begin
      pDataSet.Edit;
      pDataSet.FieldByName('Nome').AsString := lFrmTelaCadastro.edtNome.Text;
      pDataSet.FieldByName('Telefone').AsString := lFrmTelaCadastro.edtTelefone.Text;
      pDataSet.FieldByName('E-mail').AsString := lFrmTelaCadastro.edtEmail.Text;
      pDataSet.Post;
    end;
  finally
    lFrmTelaCadastro.Free;
  end;
end;

class procedure TfrmTelaCadastro.Remover(pDataSet: TClientDataSet; pOwner: TComponent);
begin
  if (not pDataSet.IsEmpty) and
  (MessageDlg('Deseja realmente excluir este contato?', mtConfirmation, [mbYes, mbNo], 0) = mrYes) then
  begin
    pDataSet.Delete;
  end;

end;

{$R *.dfm}

end.
